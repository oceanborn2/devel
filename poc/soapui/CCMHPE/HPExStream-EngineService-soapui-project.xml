<?xml version="1.0" encoding="UTF-8"?>
<con:soapui-project activeEnvironment="Default" name="HPExStream EngineService" resourceRoot="" soapui-version="5.0.0" abortOnError="false" runType="PARALLELL" xmlns:con="http://eviware.com/soapui/config"><con:settings><con:setting id="Port">8080</con:setting><con:setting id="Set endpoint for HTTP Tunnel:">http://localhost:8081/EngineService/EngineService?wsdl</con:setting><con:setting id="HTTP tunnel - KeyStore"/><con:setting id="HTTP tunnel - Password"/><con:setting id="HTTP tunnel - KeyPassword"/><con:setting id="HTTP tunnel - TrustStore"/><con:setting id="HTTP tunnel - TrustStore Password"/><con:setting id="Reuse request state">false</con:setting><con:setting id="HTTP tunnel - Set SSL Client Key Store path"/><con:setting id="Content types to monitor">*/html, */xml, */soap+xml, */json, */x-json, */javascript, */x-amf, */http</con:setting><con:setting id="HTTP tunnel - Set SSL Client Key Store Password"/></con:settings><con:interface xsi:type="con:WsdlInterface" wsaVersion="NONE" name="EngineServicePortBinding" type="wsdl" bindingName="{urn:hpexstream-services/Engine}EngineServicePortBinding" soapVersion="1_1" anonymous="optional" definition="http://localhost:8080/EngineService/EngineService?wsdl" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings/><con:definitionCache type="TEXT" rootPart="http://localhost:8080/EngineService/EngineService?wsdl"><con:part><con:url>http://localhost:8080/EngineService/EngineService?wsdl</con:url><con:content><![CDATA[<!--Published by JAX-WS RI (http://jax-ws.java.net). RI's version is Metro/2.3.1 (UNKNOWN_BRANCH-false; 2015-01-15T16:53:43+0100) JAXWS-RI/2.2.10 JAXWS-API/2.2.11 JAXB-RI/2.2.10-b140802.1033 JAXB-API/2.2.12-b140109.1041 svn-revision#unknown.-->
<!--Generated by JAX-WS RI at http://jax-ws.dev.java.net. RI's version is JAX-WS RI 2.2-hudson-752-.-->
<definitions targetNamespace="urn:hpexstream-services/Engine" name="EngineService" xmlns="http://schemas.xmlsoap.org/wsdl/" xmlns:wsp="http://www.w3.org/ns/ws-policy" xmlns:tns="urn:hpexstream-services/Engine" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:wsp1_2="http://schemas.xmlsoap.org/ws/2004/09/policy" xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/" xmlns:wsam="http://www.w3.org/2007/05/addressing/metadata" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">
  <types>
    <xsd:schema>
      <xsd:import namespace="urn:hpexstream-services/Engine" schemaLocation="http://localhost:8080/EngineService/EngineService?xsd=1"/>
    </xsd:schema>
  </types>
  <message name="Compose">
    <part name="parameters" element="tns:Compose"/>
  </message>
  <message name="ComposeResponse">
    <part name="parameters" element="tns:ComposeResponse"/>
  </message>
  <message name="EngineServiceException">
    <part name="fault" element="tns:EngineServiceException"/>
  </message>
  <portType name="EngineWebService">
    <operation name="Compose">
      <input wsam:Action="urn:hpexstream-services/Engine:EngineWebService:ComposeRequest" message="tns:Compose"/>
      <output wsam:Action="urn:hpexstream-services/Engine:EngineWebService:ComposeResponse" message="tns:ComposeResponse"/>
      <fault message="tns:EngineServiceException" name="EngineServiceException" wsam:Action="urn:hpexstream-services/Engine:EngineWebService:Compose:Fault:EngineServiceException"/>
    </operation>
  </portType>
  <binding name="EngineServicePortBinding" type="tns:EngineWebService">
    <soap:binding transport="http://schemas.xmlsoap.org/soap/http" style="document"/>
    <operation name="Compose">
      <soap:operation soapAction=""/>
      <input>
        <soap:body use="literal"/>
      </input>
      <output>
        <soap:body use="literal"/>
      </output>
      <fault name="EngineServiceException">
        <soap:fault name="EngineServiceException" use="literal"/>
      </fault>
    </operation>
  </binding>
  <service name="EngineService">
    <port name="EngineServicePort" binding="tns:EngineServicePortBinding">
      <soap:address location="http://localhost:8080/EngineService/EngineService"/>
    </port>
  </service>
</definitions>]]></con:content><con:type>http://schemas.xmlsoap.org/wsdl/</con:type></con:part><con:part><con:url>http://localhost:8080/EngineService/EngineService?xsd=1</con:url><con:content><![CDATA[<!--Published by JAX-WS RI (http://jax-ws.java.net). RI's version is Metro/2.3.1 (UNKNOWN_BRANCH-false; 2015-01-15T16:53:43+0100) JAXWS-RI/2.2.10 JAXWS-API/2.2.11 JAXB-RI/2.2.10-b140802.1033 JAXB-API/2.2.12-b140109.1041 svn-revision#unknown.-->
<xs:schema version="1.0" targetNamespace="urn:hpexstream-services/Engine" xmlns:tns="urn:hpexstream-services/Engine" xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <xs:element name="Compose" type="tns:Compose"/>
  <xs:element name="ComposeResponse" type="tns:ComposeResponse"/>
  <xs:element name="EngineServiceException" type="tns:EngineServiceException"/>
  <xs:complexType name="Compose">
    <xs:sequence>
      <xs:element name="EWSComposeRequest" type="tns:ewsComposeRequest" minOccurs="0"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="ewsComposeRequest">
    <xs:sequence>
      <xs:element name="driver" type="tns:driverFile" minOccurs="0"/>
      <xs:element name="driverEncoding" type="xs:string" minOccurs="0"/>
      <xs:element name="engineOptions" type="tns:engineOption" nillable="true" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element name="fileReturnRegEx" type="xs:string" minOccurs="0"/>
      <xs:element name="includeHeader" type="xs:boolean"/>
      <xs:element name="includeMessageFile" type="xs:boolean"/>
      <xs:element name="outputFile" type="tns:output" minOccurs="0"/>
      <xs:element name="pubFile" type="xs:string" minOccurs="0"/>
      <xs:element name="pubFiles" type="tns:pubFiles" minOccurs="0"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="driverFile">
    <xs:sequence>
      <xs:element name="driver" type="xs:base64Binary" minOccurs="0"/>
      <xs:element name="fileName" type="xs:string" minOccurs="0"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="engineOption">
    <xs:sequence>
      <xs:element name="name" type="xs:string" minOccurs="0"/>
      <xs:element name="value" type="xs:string" minOccurs="0"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="output">
    <xs:sequence>
      <xs:element name="directory" type="xs:string" minOccurs="0"/>
      <xs:element name="fileName" type="xs:string" minOccurs="0"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="pubFiles">
    <xs:sequence>
      <xs:element name="pubFile" type="xs:string" nillable="true" minOccurs="0" maxOccurs="unbounded"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="ComposeResponse">
    <xs:sequence>
      <xs:element name="return" type="tns:ewsComposeResponse" minOccurs="0"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="ewsComposeResponse">
    <xs:sequence>
      <xs:element name="engineMessage" type="xs:base64Binary" minOccurs="0"/>
      <xs:element name="files" type="tns:engineOutput" nillable="true" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element name="statusMessage" type="xs:string" minOccurs="0"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="engineOutput">
    <xs:sequence>
      <xs:element name="fileHeader" type="tns:header" minOccurs="0"/>
      <xs:element name="fileName" type="xs:string" minOccurs="0"/>
      <xs:element name="fileOutput" type="xs:base64Binary" minOccurs="0"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="header">
    <xs:sequence>
      <xs:element name="DDAOutputFile" type="xs:boolean"/>
      <xs:element name="defaultExtension" type="xs:string" minOccurs="0"/>
      <xs:element name="fileType" type="xs:string" minOccurs="0"/>
      <xs:element name="messageLength" type="xs:int"/>
      <xs:element name="outputLength" type="xs:int"/>
      <xs:element name="PDL" type="xs:int"/>
      <xs:element name="pageCount" type="xs:int"/>
      <xs:element name="returnCode" type="xs:int"/>
      <xs:element name="userData" type="xs:string" minOccurs="0"/>
      <xs:element name="userDataLength" type="xs:int"/>
      <xs:element name="version" type="xs:int"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="EngineServiceException">
    <xs:sequence>
      <xs:element name="faultInfo" type="xs:string" minOccurs="0"/>
      <xs:element name="message" type="xs:string" minOccurs="0"/>
    </xs:sequence>
  </xs:complexType>
</xs:schema>]]></con:content><con:type>http://www.w3.org/2001/XMLSchema</con:type></con:part></con:definitionCache><con:endpoints><con:endpoint>http://192.160.66.229:8080/EngineService/EngineService?wsdl</con:endpoint><con:endpoint>http://FR05168618D:8088/mockEngineServicePortBinding</con:endpoint><con:endpoint>http://localhost:8080/EngineService/EngineService</con:endpoint><con:endpoint>http://localhost:8080/EngineService/EngineService</con:endpoint></con:endpoints><con:operation isOneWay="false" action="" name="Compose" bindingOperationName="Compose" type="Request-Response" inputName="" receivesAttachments="false" sendsAttachments="false" anonymous="optional"><con:settings/><con:call name="Request 1"><con:settings/><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080/EngineService/EngineService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:eng="urn:hpexstream-services/Engine">
   <soapenv:Header/>
   <soapenv:Body>
      <eng:Compose>
         <!--Optional:-->
         <EWSComposeRequest>
            <!--Optional:-->
            <driver>
               <!--Optional:-->
               <driver>cid:1186787309489</driver>
               <!--Optional:-->
               <fileName>?</fileName>
            </driver>
            <!--Optional:-->
            <driverEncoding>?</driverEncoding>
            <!--Zero or more repetitions:-->
            <engineOptions>
               <!--Optional:-->
               <name>?</name>
               <!--Optional:-->
               <value>?</value>
            </engineOptions>
            <!--Optional:-->
            <fileReturnRegEx>?</fileReturnRegEx>
            <includeHeader>?</includeHeader>
            <includeMessageFile>?</includeMessageFile>
            <!--Optional:-->
            <outputFile>
               <!--Optional:-->
               <directory>?</directory>
               <!--Optional:-->
               <fileName>?</fileName>
            </outputFile>
            <!--Optional:-->
            <pubFile>?</pubFile>
            <!--Optional:-->
            <pubFiles>
               <!--Zero or more repetitions:-->
               <pubFile>?</pubFile>
            </pubFiles>
         </EWSComposeRequest>
      </eng:Compose>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508" action="urn:hpexstream-services/Engine:EngineWebService:ComposeRequest"/><con:wsrmConfig version="1.2"/></con:call></con:operation></con:interface><con:testSuite name="EngineServicePortBinding TestSuite"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="ComposeReturnStream" searchProperties="true" id="bde84daa-c848-40cb-a745-ec8d54cbe308"><con:description>This testcase configures the composition request so that a stream is returned directly within the HTTP response.</con:description><con:settings/><con:testStep type="request" name="ComposeStream"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>EngineServicePortBinding</con:interface><con:operation>Compose</con:operation><con:request name="ComposeStream"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting><con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://192.160.66.229:8080/EngineService/EngineService?wsdl</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:eng="urn:hpexstream-services/Engine">
   <soapenv:Header/>
   <soapenv:Body>
      <eng:Compose>
         <!--Optional:-->
         <EWSComposeRequest>
            <!--Optional:-->
            <driver>
                <!--Optional:-->
               <driver>PEN1c3RvbWVyPg0KPERvYz5IZWxsb1dvcmxkPC9Eb2M+DQo8L0N1c3RvbWVyPg==</driver>
               <!--Optional:-->
               <fileName>INPUT</fileName>
            </driver>
            <!--Zero or more repetitions:-->
            <engineOptions>
               <!--Optional:-->
               <name>TRACKIN</name>
               <!--Optional:-->
               <value>DISABLE</value>
            </engineOptions>
            <!--Optional:-->
            <includeHeader>true</includeHeader>
            <includeMessageFile>true</includeMessageFile>
            <!--Optional:-->
            <!--pubFile>HelloWorld.pub</pubFile-->
            <pubFile>HelloWorld_DLF_Full_Encryption.pub</pubFile>
         </EWSComposeRequest>
      </eng:Compose>
   </soapenv:Body>
</soapenv:Envelope>
]]></con:request><con:credentials><con:username/><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig action="urn:hpexstream-services/Engine:EngineWebService:ComposeRequest" mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="decodeMockedStream"><con:settings/><con:config><script>// mock the PDF stream as a base64 string 
def pdfStream = 'JVBERi0xLjUKMSAwIG9iago8PCAvQ3JlYXRvciAoSFAgRXhzdHJlYW0gVmVyc2lvbiA5LjAuMTA0IDY0LWJpdCAoREJDUykpCi9DcmVhdGlvbkRhdGUgKDIvNC8yMDE1IDE0OjUwOjQ4KQovQXV0aG9yIChSZWdpc3RlcmVkIHRvOiBTR1BSQkFOSykKL1RpdGxlIChIZWxsb1dvcmxkX0FwcCkKPj4KZW5kb2JqCiVQREYgRm9udCAoRjQwKQo2ICAgICAwIG9iago8PAovVHlwZSAvRm9udAovU3VidHlwZSAvVHlwZTEKL0Jhc2VGb250IC9UaW1lcy1Cb2xkCj4+CmVuZG9iagolUERGIEZvbnQgKEY5MCkKNyAgICAgMCBvYmoKPDwKL1R5cGUgL0ZvbnQKL1N1YnR5cGUgL1R5cGUxCi9CYXNlRm9udCAvVGltZXMtUm9tYW4KPj4KZW5kb2JqCjEwIDAgb2JqCjw8L0xlbmd0aCA0NDgvRmlsdGVyWy9BU0NJSTg1RGVjb2RlL0ZsYXRlRGVjb2RlXT4+c3RyZWFtCkdhdCR1YkErbWomSC5rc1dcaGlRN3BdRSNYaWokdV01YVQ/PXRKJ08oIyZZOFBNRV5jXE9gQSpgUF1ANjNBWDhJQ0otZSZyME9sO29xKj8pcWlQUHA7PVtPPSdkYmo7NmUrN0ljODNsdS8jXUleW1Y9SShIZ1QqcTRmQFMvQk8oZVxRNzpwX3FlJT4mL0soXDg9O20vNi5kclErXC86cGIiQTYkODguSSwjV3RDZSJALGwiMF51R14mTFJqQSI1cG1aRWpaNDFaMD9FRjtTVGleWVAhK2VXSypMTTkzJmFbcFVKRUxHQCcoMT1tSVkiaGYtIVk7OyYzN1lCMHFjLkFHKDoqZyJYNVwxXmAvVyhtQCxHMj1CWjVTYyJpQSVEJmYzXXM7T2kvV2F1Lik/aEg/PV8iYFpBOSE1Llh0NDgqYUBdbUEnTzBDZT0yP1coMzlyLTw9KG1UcS1hMmolLFA2OkRBOUY+J0woXzFXT108TVg3ZENgcSR1RUQ6R0VrblYqb1gqYm5gZ1RUais/aChKX00oOT4yX2IjKlZAJjVuVWREJy1iPmpZWUAqK3RfP0VQalkoKWRmMW05Y01+PgoKZW5kc3RyZWFtCmVuZG9iagoxMSAwIG9iago8PC9UeXBlL1BhZ2UvUGFyZW50IDEyIDAgUi9Db250ZW50cyAxMCAwIFIvUmVzb3VyY2VzIDUgMCBSPj4KZW5kb2JqCjEyIDAgb2JqCjw8L1R5cGUvUGFnZXMvQ291bnQgMS9LaWRzWzExIDAgUl0vTWVkaWFCb3hbMCAwIDYxMiA3OTJdL1Jlc291cmNlcyA1IDAgUj4+CmVuZG9iago1IDAgb2JqCjw8L1Byb2NTZXRbL1BERi9JbWFnZUIvSW1hZ2VDL1RleHRdL0ZvbnQ8PC9GNDAgNiAwIFIgCi9GOTAgNyAwIFIgPj4KPj4KZW5kb2JqCjggMCBvYmoKPDwvVGl0bGUgKP7/ADEAOgAgKS9EZXN0WzExIDAgUi9YWVogOTk5IDk5OSAwXS9QYXJlbnQgMyAwIFIvRmlyc3QgOSAwIFIvTGFzdCA5IDAgUi9Db3VudCAtMT4+CgplbmRvYmoKOSAwIG9iago8PC9UaXRsZSAo/v8ASABlAGwAbABvAFcAbwByAGwAZABfAEQAbwBjKS9EZXN0WzExIDAgUi9YWVogOTk5IDk5OSAwXS9QYXJlbnQgOCAwIFI+PgoKZW5kb2JqCjMgMCBvYmoKPDwgL0NvdW50IDEgL0ZpcnN0IDggMCBSIC9MYXN0IDggMCBSID4+CmVuZG9iagoyIDAgb2JqCjw8L1R5cGUvQ2F0YWxvZy9QYWdlcyAxMiAwIFIvT3V0bGluZXMgMyAwIFIvUGFnZU1vZGUvVXNlT3V0bGluZXM+PgplbmRvYmoKeHJlZgowIDEzCjAwMDAwMDAwMDAgNjU1MzUgZiAKMDAwMDAwMDAwOSAwMDAwMCBuIAowMDAwMDAxNDA5IDAwMDAwIG4gCjAwMDAwMDEzNTQgMDAwMDAgbiAKMDAwMDAwMDAwMCAwMDAwMCBmIAowMDAwMDAxMDU4IDAwMDAwIG4gCjAwMDAwMDAxOTEgMDAwMDAgbiAKMDAwMDAwMDI4MiAwMDAwMCBuIAowMDAwMDAxMTQ0IDAwMDAwIG4gCjAwMDAwMDEyNTQgMDAwMDAgbiAKMDAwMDAwMDM1OCAwMDAwMCBuIAowMDAwMDAwODkwIDAwMDAwIG4gCjAwMDAwMDA5NjcgMDAwMDAgbiAKdHJhaWxlcjw8L1NpemUgMTMvSW5mbyAxIDAgUi9Sb290IDIgMCBSCj4+CnN0YXJ0eHJlZgoxNDkxCiUlRU9GCg=='

// mock the engine message
def engMsg = 'ICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAqIEhQIEV4c3RyZWFtIFZlcnNpb24gOS4wLjEwNCA2NC1iaXQgKERCQ1MpDQogKiBFeGVjdXRpb24gQmVnaW5zOiAyLzQvMjAxNSAgIDE0OjUwOjQ4DQogKiBNZXNzYWdlIEZpbGUgICgxNjM1MTUpDQogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAqICAgICAgICAgU3VtbWFyeSBvZiBFeHN0cmVhbSBSdW4gT3B0aW9ucyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqDQogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICogICBSdW4gQXMtT2YgRGF0ZTogICAgICAgICBNb250aCAoMikgIERheSAoNCkgIFllYXIgKDIwMTUpDQogKiAgIENvbnRyb2wgRmlsZTogICAgICAgICAgIEM6XEhwRXhzdHJlYW1cU2NyYXRjaFxIZWxsb1dvcmxkOWRlNDA1MThkMzFmNGJlMTg1N2JkMGFlOTFhNGYwZTlcY29udHJvbC5vcHQNCiAqICAgQ29udHJvbCBGaWxlIEVuY29kaW5nOiAgSVNPODg1OTENCiAqICAgUGFja2FnZSBGaWxlICggIDEpOiAgICAgQzpcSHBFeHN0cmVhbVxQYWNrYWdlc1xIZWxsb1dvcmxkLnB1YiAtLSBBcHBsaWNhdGlvbiBQYWNrYWdlDQogKiAgIE1lc3NhZ2UgRmlsZTogICAgICAgICAgIEM6XEhwRXhzdHJlYW1cU2NyYXRjaFxIZWxsb1dvcmxkOWRlNDA1MThkMzFmNGJlMTg1N2JkMGFlOTFhNGYwZTlcbWVzc2FnZXMuZGF0DQogKiAgIFJlcG9ydCAgRmlsZTogICAgICAgICAgIEV4c3RyZWFtUmVwb3J0LmRhdA0KICogICBUcmFjayAgIEZpbGU6ICAgICAgICAgICBFeHN0cmVhbVRyYWNrLmRhdA0KICogICBOb24tUXVldWUgT3V0cHV0IEZpbGU6ICBDOlxIcEV4c3RyZWFtXFNjcmF0Y2hcSGVsbG9Xb3JsZDlkZTQwNTE4ZDMxZjRiZTE4NTdiZDBhZTkxYTRmMGU5XEhlbGxvV29ybGQub3V0DQogKiAgIE91dHB1dCBEaXJlY3Rvcnk6ICBDOlxIcEV4c3RyZWFtXFNjcmF0Y2hcSGVsbG9Xb3JsZDlkZTQwNTE4ZDMxZjRiZTE4NTdiZDBhZTkxYTRmMGU5XA0KICogICBSdW4gTW9kZTogICAgICAgICAgICAgICBQcm9kdWN0aW9uDQogKiAgIENvbXBpbGVkIEVuZ2luZSBUeXBlOiAgIFJlbGVhc2UgUHJvZHVjdGlvbg0KICogICBQcm9ncmFtIEZ1bmN0aW9uczogICAgICBDb21wb3NpdGlvbg0KICogICBFcnJvciBTdG9wIExldmVsOiAgICAgICBTZXZlcmUNCiAqICAgUG9zdCBTb3J0IE1vZGU6ICAgICAgICAgTm8NCiAqICAgQ3JlYXRlIE91dHB1dCBGaWxlczogICAgWWVzDQogKiAgIERpc2FibGUgUHJpbnQgRmlsZXM6ICAgIE5vDQogKiAgIERpc2FibGUgT3V0cHV0IFNvcnQ6ICAgIE5vDQogKiAgIENhbXBhaWduIFJlcG9ydCBMZXZlbDogIE5vbmUNCiAqICAgVHJhY2tpbmcgRFNOOiAgICAgICAgICAgRXhzdHJlYW0gVHJhY2tpbmcgOS4wLjEwNA0KICogICBUcmFja2luZyBTY2hlbWE6ICAgICAgICBOb25lDQogKiAgIFRyYWNraW5nIFR5cGU6ICAgICAgICAgIEZpbGUNCiAqICAgVHJhY2tpbmcgSW5wdXQ6ICAgICAgICAgTm9uZSAoZGlzYWJsZSBhY3Rpdml0eS1iYXNlZCBjYW1wYWlnbnMpDQogKiAgIFZlcmJvc2UgUHJvZ3Jlc3M6ICAgICAgIEF1dG9tYXRpYw0KICogICBPdmVybGF5IE1vZGU6ICAgICAgICAgICBCYXNlZCBPbiBQcmludGVyDQogKiAgIE1heGltdW0gT3ZlcmxheXM6ICAgICAgIEJhc2VkIE9uIFByaW50ZXINCiAqICAgSW1wb3J0IERpcmVjdG9yeTogICAgICAgDQogKiAgIFByb2Nlc3MgQ3VzdG9tZXJzOiAgICAgIDAgdG8gOTk5OTk5OTk5IGJ5IDENCiAqICAgRmlsZSBNYXBwaW5nOiAgICAgICAgICAgMSBGaWxlcyBBcmUgTWFwcGVkDQogKiAgICAgICBJTlBVVCAgPT09PiAgQzpcSHBFeHN0cmVhbVxTY3JhdGNoXEhlbGxvV29ybGQ5ZGU0MDUxOGQzMWY0YmUxODU3YmQwYWU5MWE0ZjBlOVxJTlBVVCAgIA0KICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogKiAgICAgICAgIFBhY2thZ2UgRmlsZSBPdmVydmlldyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKg0KICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAqICAgQ3JlYXRpb24gRGF0ZSA6ICAgICAgICAgMDEvMjgvMjAxNSAgMTE6NDMNCiAqICAgQ3JlYXRlZCBCeSA6ICAgICAgICAgICAgYWRtaW4NCiAqICAgRGVzaWduIE1hbmFnZXIgVmVyc2lvbiA6OTAwMTA0DQogKiAgIFBhY2thZ2UgQ29udGVudHM6ICAgICAgIENvbXBsZXRlDQogKiAgIFBhY2thZ2UgVHlwZTogICAgICAgICAgIEZ1bGwgQXBwbGljYXRpb24gUGFja2FnZQ0KICogICBBcHBsaWNhdGlvbjogICAgICAgICAgICBIZWxsb1dvcmxkX0FwcA0KICogICBBcHBsaWNhdGlvbiByZXZpc2VkIDogICAwMS8yOC8yMDE1ICAxMTo0Mg0KICogICBBcHBsaWNhdGlvbiB2ZXJzaW9uIDogICAxDQogKiAgIFBhY2thZ2UgT2JqZWN0IFZlcnNpb246IFdJUCBmb3IgYWxsIHVzZXJzDQogKiAgIFBhY2thZ2UgQXMtb2YgRGF0ZTogICAgIE5vdyAoMDEvMjgvMjAxNSAgMTE6NDMpDQogKiAgIEFwcGxpY2F0aW9uIFF1ZXVlczogICAgIEVuYWJsZWQNCiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQogKiAgIE91dHB1dCB3aWxsIGJlIHdyaXR0ZW4gdG8gUXVldWUgZmlsZXMsIG5vdCB0aGUgTm9uLVF1ZXVlIE91dHB1dCBGaWxlDQogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KICogICBSdWxlcyBvbiBRdWV1ZXMgcHJvY2Vzc2VkIEFGVEVSIGNvbXBvc2l0aW9uIGJlY2F1c2Ugb2YgdmFyaWFibGVzIHVzZWQgaW4gcnVsZXMuDQogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KIERyYXdQYXJ0IFBETCBQcmludCBNZW1vcnkgLSBUb3RhbDogIDEyMDU4DQogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KIE51bWJlciBvZiBtZXNzYWdlcyBpc3N1ZWQ6ICAgICAzICAgIHRvdGFsIGNhbGxlZDogIDMNCiBOdW1iZXIgb2YgY3VzdG9tZXJzIHByb2Nlc3NlZDogMQ0KIE51bWJlciBvZiBjdXN0b21lciBjb21tdW5pY2F0aW9ucyBwcm9kdWNlZDogMQ0KIE51bWJlciBvZiBwYWdlcyBwcm9jZXNzZWQ6ICAgICAxICAgICgwIGJsYW5rKQ0KIFByb2dyYW0gc3RhcnQgJiBlbmQ6ICAgICAgICAgICAwMi8wNC8yMDE1IDE0OjUwOjQ4IC0gMTQ6NTA6NDgNCiBFbGFwc2VkIHdhbGwgY2xvY2sgdGltZTogICAgICAgMDA6MDA6MDANCiBFbGFwc2VkIENQVSB0aW1lOiAgICAgICAgICAgICAgMC4wMSAgc2VjIFNFVFVQICAwLjAxICBzZWMgVE9UQUwNCiBDUFUgUGVyZm9ybWFuY2U6ICAgICAgICAgICAgICAgMzYwMDAwIFBncy9IciAgMTAwLjAgUGdzL1NlYw0KIFdhbGwgY2xvY2sgcGVyZm9ybWFuY2U6ICAgICAgICBDYW5ub3QgYmUgY2FsY3VsYXRlZA0K'

def base64toString (String s) {
	if (s.size()==0 || s.trim().size() == 0) { '' } 
	byte[] decBytes = s.decodeBase64()
	new String(decBytes)
}

def getStringAsArray(String fullText) {
	def lines = []
	fullText.split("\r\n").each { String it -> lines.add(it) } //collect() //each ( it -> 
	lines
}

def display (lines) {
	log.info('\r\n\r\n')
	lines.each { it -> log.info(it) }
}
// decode both pdf stream and engine message
pdfStreamLines = getStringAsArray(base64toString(pdfStream))
assert pdfStreamLines.size() > 0
assert pdfStreamLines[0].startsWith('%PDF-1.5') 
display(pdfStreamLines)

engMsgLine = getStringAsArray(base64toString(engMsg))
display(engMsgLine)

'OK'
</script></con:config></con:testStep><con:testStep type="groovy" name="decodeRealStream"><con:settings/><con:config><script>def base64toString (String s) {
	if (s.size()==0 || s.trim().size() == 0) { '' } 
	byte[] decBytes = s.decodeBase64()
	new String(decBytes)
}

def getStringAsArray(String fullText) {
	def lines = []
	fullText.split("\r\n").each { String it -> lines.add(it) } //collect() //each ( it -> 
	lines
}


def groovyUtils = new com.eviware.soapui.support.GroovyUtils(context);  
def stepBase = testRunner.testCase.testSteps["ComposeStream"]; 
stepBase.run(testRunner, context)

def xmlResult = stepBase.testRequest.response.getContentAsXml(); 

// get a holder object to deal with XPATH 
def responseHolder = groovyUtils.getXmlHolder(xmlResult)

// extract the result
def commandLines = responseHolder.getNodeValues("//fileOutput/text()")
log.info commandLines.getClass().getName() + " " + commandLines.size() + " lines found";  // ----------------------  // retrieve the properties step object def configPropsStep = testRunner.testCase.testSteps["configTest"];  // read the 2 properties within it def nbOrdersToCreate = Integer.valueOf(configPropsStep.getPropertyValue("nbOrdersToCreate")); def nbLinesPerOrder = Integer.valueOf(configPropsStep.getPropertyValue("nbLinesPerOrder"));  // compute the amount of line to build def numRows = nbOrdersToCreate * nbLinesPerOrder;  // retrieve the SOAP step : createOrder def createOrderStep = testRunner.testCase.testSteps["createOrder"];  def count = 0; StringBuilder ordersToDelete = new StringBuilder(); for(def i=1; i&lt;=nbOrdersToCreate; i++) {     StringBuilder lines = new StringBuilder();     for(def j=1; j&lt;=nbLinesPerOrder; j++) {         int index = i>1 ? (i-1) * nbLinesPerOrder + j-1 : i*j-1;         lines.append(OrderLines.getAt(index));     }       // transfer the Orderlines as String into the temp properties step     tempProps.setPropertyValue("orderlines", lines.toString());     tempProps.setPropertyValue("numOrder", String.valueOf(count++));       // run the SOAP step Create     testRunner.runTestStep(createOrderStep);       // retrieve the SOAP response as XML     def xmlRespCreate = createOrderStep.testRequest.response.getContentAsXml();     def createHolder = groovyUtils.getXmlHolder(xmlRespCreate);        // assume that the createOrder operation returns an order code in the right tag     def OrderCode = createHolder.getNodeValue("//OrderCode");        // build the string to put in the deleteOrder SOAP step     ordersToDelete.append("&lt;OrderCode>" + OrderCode + "&lt;/OrderCode>"); }  // finally, transfert this String into the temp properties step. tempProps.setPropertyValue("ordersToDelete

commandLines.each { commandLine ->
	log.info(getStringAsArray(base64toString(commandLine)))
}

'COMPLETED OK'</script></con:config></con:testStep><con:properties/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="ComposeReturnURL" searchProperties="true" id="aa7b9e53-3441-4be5-9a73-c3a85c805108"><con:description>This testcase configures the composition request so that an URL is returned to the caller which must then do a GET operation in order to retrieve the document. </con:description><con:settings/><con:testStep type="request" name="ComposeURL"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>EngineServicePortBinding</con:interface><con:operation>Compose</con:operation><con:request name="ComposeURL"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting><con:setting id="com.eviware.soapui.impl.support.AbstractHttpRequest@follow-redirects">true</con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://192.160.66.229:8080/EngineService/EngineService?wsdl</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:eng="urn:hpexstream-services/Engine">
   <soapenv:Header/>
   <soapenv:Body>
      <eng:Compose>
         <!--Optional:-->
         <EWSComposeRequest>
            <!--Optional:-->
            <driver>
               <!--Optional:-->
               <driver>PEN1c3RvbWVyPg0KPERvYz5IZWxsb1dvcmxkPC9Eb2M+DQo8L0N1c3RvbWVyPg==</driver>
               <!--Optional:-->
               <fileName>INPUT</fileName>
            </driver>
            <!--Zero or more repetitions:-->
            <engineOptions>
               <!--Optional:-->
               <name>TRACKIN</name>
               <!--Optional:-->
               <value>DISABLE</value>
            </engineOptions>
            <!--Optional:-->
            <fileReturnRegEx>false</fileReturnRegEx>
            <includeHeader>true</includeHeader>
            <includeMessageFile>true</includeMessageFile>
            <!--Optional:-->
            <!--Optional:-->
            <outputFile>
               <!--Optional:-->
               <directory>identifiant_Unique</directory>
               <!--Optional:-->
               <fileName>identifiant.pdf</fileName>
            </outputFile>
            <!--Optional:-->
            <pubFile>HelloWorld_DLF_Full_Encryption.pub</pubFile>
         </EWSComposeRequest>
      </eng:Compose>
   </soapenv:Body>
</soapenv:Envelope>
]]></con:request><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig action="urn:hpexstream-services/Engine:EngineWebService:ComposeRequest" mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="decodeRealURL"><con:settings/><con:config><script><![CDATA[def base64toString (String s) {
	if (s.size()==0 || s.trim().size() == 0) { '' } 
	byte[] decBytes = s.decodeBase64()
	new String(decBytes)
}

def getStringAsArray(String fullText) {
	def lines = []
	fullText.split("\r\n").each { String it -> lines.add(it) }  
	lines
}

def groovyUtils = new com.eviware.soapui.support.GroovyUtils(context);  
def stepBase = testRunner.testCase.testSteps["ComposeURL"]; 
stepBase.run(testRunner, context)

def xmlResult = stepBase.testRequest.response.getContentAsXml(); 
log.info(xmlResult)

// get a holder object to deal with XPATH 
def responseHolder = groovyUtils.getXmlHolder(xmlResult)

// extract the result
def commandLines = responseHolder.getNodeValues("//engineMessage/text()")
log.info commandLines.getClass().getName() + " " + commandLines.size() + " lines found";  // ----------------------  // retrieve the properties step object def configPropsStep = testRunner.testCase.testSteps["configTest"];  // read the 2 properties within it def nbOrdersToCreate = Integer.valueOf(configPropsStep.getPropertyValue("nbOrdersToCreate")); def nbLinesPerOrder = Integer.valueOf(configPropsStep.getPropertyValue("nbLinesPerOrder"));  // compute the amount of line to build def numRows = nbOrdersToCreate * nbLinesPerOrder;  // retrieve the SOAP step : createOrder def createOrderStep = testRunner.testCase.testSteps["createOrder"];  def count = 0; StringBuilder ordersToDelete = new StringBuilder(); for(def i=1; i<=nbOrdersToCreate; i++) {     StringBuilder lines = new StringBuilder();     for(def j=1; j<=nbLinesPerOrder; j++) {         int index = i>1 ? (i-1) * nbLinesPerOrder + j-1 : i*j-1;         lines.append(OrderLines.getAt(index));     }       // transfer the Orderlines as String into the temp properties step     tempProps.setPropertyValue("orderlines", lines.toString());     tempProps.setPropertyValue("numOrder", String.valueOf(count++));       // run the SOAP step Create     testRunner.runTestStep(createOrderStep);       // retrieve the SOAP response as XML     def xmlRespCreate = createOrderStep.testRequest.response.getContentAsXml();     def createHolder = groovyUtils.getXmlHolder(xmlRespCreate);        // assume that the createOrder operation returns an order code in the right tag     def OrderCode = createHolder.getNodeValue("//OrderCode");        // build the string to put in the deleteOrder SOAP step     ordersToDelete.append("<OrderCode>" + OrderCode + "</OrderCode>"); }  // finally, transfert this String into the temp properties step. tempProps.setPropertyValue("ordersToDelete
commandLines.each { commandLine ->
	getStringAsArray(base64toString(commandLine)).each  { line ->
		log.info(line)
	}
}

log.info("> ____________ RESPONSE START ________________")
def responseLines  = responseHolder.getNodeValues("//fileOutput/text()")
log.info responseLines.getClass().getName() + " " + responseLines.size() + " lines found";  // ----------------------  // retrieve the properties step object def configPropsStep = testRunner.testCase.testSteps["configTest"];  // read the 2 properties within it def nbOrdersToCreate = Integer.valueOf(configPropsStep.getPropertyValue("nbOrdersToCreate")); def nbLinesPerOrder = Integer.valueOf(configPropsStep.getPropertyValue("nbLinesPerOrder"));  // compute the amount of line to build def numRows = nbOrdersToCreate * nbLinesPerOrder;  // retrieve the SOAP step : createOrder def createOrderStep = testRunner.testCase.testSteps["createOrder"];  def count = 0; StringBuilder ordersToDelete = new StringBuilder(); for(def i=1; i<=nbOrdersToCreate; i++) {     StringBuilder lines = new StringBuilder();     for(def j=1; j<=nbLinesPerOrder; j++) {         int index = i>1 ? (i-1) * nbLinesPerOrder + j-1 : i*j-1;         lines.append(OrderLines.getAt(index));     }       // transfer the Orderlines as String into the temp properties step     tempProps.setPropertyValue("orderlines", lines.toString());     tempProps.setPropertyValue("numOrder", String.valueOf(count++));       // run the SOAP step Create     testRunner.runTestStep(createOrderStep);       // retrieve the SOAP response as XML     def xmlRespCreate = createOrderStep.testRequest.response.getContentAsXml();     def createHolder = groovyUtils.getXmlHolder(xmlRespCreate);        // assume that the createOrder operation returns an order code in the right tag     def OrderCode = createHolder.getNodeValue("//OrderCode");        // build the string to put in the deleteOrder SOAP step     ordersToDelete.append("<OrderCode>" + OrderCode + "</OrderCode>"); }  // finally, transfert this String into the temp properties step. tempProps.setPropertyValue("ordersToDelete
responseLines.each { resp ->
	getStringAsArray(base64toString(resp)).each { line -> log.info(line) }
}
log.info("> ____________ RESPONSE END __________________")

'COMPLETED OK']]></script></con:config></con:testStep><con:properties/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="InteractiveScenarioDirectStream" searchProperties="true"><con:settings/><con:testStep type="request" name="Requete_DLF_DS"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>EngineServicePortBinding</con:interface><con:operation>Compose</con:operation><con:request name="Requete_DLF_DS"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080/EngineService/EngineService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:eng="urn:hpexstream-services/Engine">
   <soapenv:Header/>
   <soapenv:Body>
      <eng:Compose>
         <!--Optional:-->
         <EWSComposeRequest>
            <!--Optional:-->
            <driver>
               <!--Optional:-->
               <driver>PEN1c3RvbWVyPg0KPERvYz5IZWxsb1dvcmxkPC9Eb2M+DQo8L0N1c3RvbWVyPg==</driver>
               <!--Optional:-->
               <fileName>INPUT</fileName>
            </driver>
            <!--Zero or more repetitions:-->
            <engineOptions>
               <!--Optional:-->
               <name>TRACKIN</name>
               <!--Optional:-->
               <value>DISABLE</value>
            </engineOptions>
            <!--Optional:-->
            <includeHeader>true</includeHeader>
            <includeMessageFile>true</includeMessageFile>
    		  <FileReturnRegEx>true</FileReturnRegEx>

            <!--Optional:-->
            <pubFile>HelloWorld_DLF_Full_Encryption.pub</pubFile>
         </EWSComposeRequest>
      </eng:Compose>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response"/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="DirectStreamScenario"><con:settings/><con:config><script>// 1st step: Run the SOAP request against the EWS web service and retrieve the base64 encoded response
// Either continue or stop based on error status
def step1RequestDLF() {
	// grab the testcase and run it
	def groovyUtils = new com.eviware.soapui.support.GroovyUtils(context);  
	def stepBase = testRunner.testCase.testSteps["Requete_DLF_DS"]; 
	stepBase.run(testRunner, context)

	// retrieve the returning XML stream
	def xmlResult = stepBase.testRequest.response.getContentAsXml(); 
	log.info(xmlResult)
	
	// get a holder object to deal with XPATH 
	def responseHolder = groovyUtils.getXmlHolder(xmlResult)

	response = responseHolder.getNodeValues("//fileOutput/text()")
	log.info("response size : " + response[0].size())
	def httpResponse = context.expand( '${Test Request: login#Response}' )
	log.info(httpResponse)
	//log.info(">>>" + response[0] +"&lt;&lt;&lt;")
	response[0]
}

// decode from base64 and store into a template.dlf file
def step2DecodeAndStoreDLF(String text) {
	
	String HOMEDIR = "D:/X118372/CCM/poc/CCMHPE"
//	String currDir = new File(".").getAbsolutePath()
//	log.info(currDir)

	File b64 = new  File("${HOMEDIR}/template.base64.txt")
	if (b64.exists()) {
		b64.delete()
	}
	b64.createNewFile()
	b64.setBytes(text.bytes)		 	

	// Write decoded response to DLF file
	byte[] response = base64toBytes(text) //bytes 	
	File f = new File("${HOMEDIR}/template.dlf")
	if (f.exists()) {
		f.delete()
	}
	f.createNewFile()
	f.setBytes(response)		 
	
	//"${HOMEDIR}/template.dlf"
	"${HOMEDIR}/template.dlf"
}

def step3RunLiveEditor(List&lt;String> params) {
	def cmdLineArgs = params.join(" ")
	runLiveEditor(cmdLineArgs)
}

// *************************************************************
// Scenario entry point
// actual program storage folder
def response = step1RequestDLF()
def dlfPath  = step2DecodeAndStoreDLF(response)
step3RunLiveEditor([dlfPath])

'COMPLETED OK'



// *************************************************************
// utility functions
//

// decode a base64 string to a stream of bytes
def base64toBytes (String s) {
	if (s.size()==0 || s.trim().size() == 0) { '' } 
	byte[] decBytes = s.decodeBase64()
}

// decode a base64 string to a cleartext string
def base64toString (String s) {
	new String(base64toBytes(s))
}

// split a string and return an array of string
// splitting is done based on the sep character sequence
def getStringAsArray(String fullText,sep="\r\n") {
	def lines = []
	fullText.split(sep).each { String it -> lines.add(it) }  
	lines
}


// run the live editor
def runLiveEditor(cmdLine) {
	//def LEPath = 'C:/Program Files (x86)/Hewlett-Packard/HP Exstream/LiveEditor 4.0.104/Live.exe'
	def LEPath = 'C:/Program Files (x86)/Internet Explorer/iexplore.exe'
	def command = "${LEPath} ${cmdLine}"      // Create the String
	def proc = command.execute()    // Call *execute* on the string
	proc.waitFor()                  // Wait for the command to finish
}</script></con:config></con:testStep><con:properties/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="InteractiveScenarioURL" searchProperties="true" id="cc1995a4-9165-413f-8987-9ac69d1be7e8"><con:settings/><con:testStep type="request" name="Requete_DLF_URL"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>EngineServicePortBinding</con:interface><con:operation>Compose</con:operation><con:request name="Requete_DLF_URL"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080/EngineService/EngineService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:eng="urn:hpexstream-services/Engine">
   <soapenv:Header/>
   <soapenv:Body>
      <eng:Compose>
         <!--Optional:-->
         <EWSComposeRequest>
            <!--Optional:-->
            <driver>
               <!--Optional:-->
               <driver>PEN1c3RvbWVyPg0KPERvYz5IZWxsb1dvcmxkPC9Eb2M+DQo8L0N1c3RvbWVyPg==</driver>
               <!--Optional:-->
               <fileName>INPUT</fileName>
            </driver>
            <!--Zero or more repetitions:-->
            <engineOptions>
               <!--Optional:-->
               <name>TRACKIN</name>
               <!--Optional:-->
               <value>DISABLE</value>
            </engineOptions>
            <!--Optional:-->
            <includeHeader>true</includeHeader>
            <includeMessageFile>true</includeMessageFile>
		  <FileReturnRegEx>true</FileReturnRegEx>
		  
              <outputFile>
               <!--Optional:-->
               <directory>bd093eeb8cf8411241e65682af5502e6e5701662</directory>
               <!--Optional:-->
               <fileName>myfile</fileName>
            </outputFile>
            
            <!--Optional:-->
		 <pubFile>HelloWorld_DLF_Full_Encryption.pub</pubFile>
		 <!--pubFile>HelloWorld_DLF.pub</pubFile-->
         </EWSComposeRequest>
      </eng:Compose>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response"/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="URLScenario"><con:settings/><con:config><script>import java.security.SecureRandom

// 1st step: Run the SOAP request against the EWS web service and retrieve the base64 encoded response
// Either continue or stop based on error status
def step1RequestURL() {

	//byte seed[] = SecureRandom.generateSeed(20)
	def s = new SecureRandom()	
	def key = new byte[20]
	s.nextBytes(key)
	def skey = key.encodeHex().toString()
	
	// grab the testcase and run it
	def groovyUtils = new com.eviware.soapui.support.GroovyUtils(context);  
	def stepBase = testRunner.testCase.testSteps["Requete_DLF_URL"]
	
	holder = groovyUtils.getXmlHolder( "Requete_DLF_URL#Request" )
	holder["//outputFile/directory/text()"] = skey
	holder.updateProperty()

	holder["//outputFile/fileName/text()"] = "myfile"
	holder.updateProperty()

	stepBase.run(testRunner, context) 
	
	// retrieve the returning XML stream
	def xmlResult = stepBase.testRequest.response.getContentAsXml()
	log.info(xmlResult)
	
	// get a holder object to deal with XPATH 
	def responseHolder = groovyUtils.getXmlHolder(xmlResult)

	response = responseHolder.getNodeValues("//fileName/text()")
	log.info("returned URL : " + response[0].size() + " => " + response[0])
	response[0]
}

def step3RunLiveEditor(List&lt;String> params) {
	def cmdLineArgs = params.join(" ")
	runLiveEditor(cmdLineArgs)
}

// *************************************************************
// Scenario entry point
// actual URL
def dlfPath = step1RequestURL()
step3RunLiveEditor([dlfPath])

'COMPLETED OK'



// *************************************************************
// utility functions
//

// decode a base64 string to a stream of bytes
def base64toBytes (String s) {
	if (s.size()==0 || s.trim().size() == 0) { '' } 
	byte[] decBytes = s.decodeBase64()
}

// decode a base64 string to a cleartext string
def base64toString (String s) {
	new String(base64toBytes(s))
}

// split a string and return an array of string
// splitting is done based on the sep character sequence
def getStringAsArray(String fullText,sep="\r\n") {
	def lines = []
	fullText.split(sep).each { String it -> lines.add(it) }  
	lines
}


// run the live editor
def runLiveEditor(cmdLine) {
	//def LEPath = 'C:/Program Files (x86)/Hewlett-Packard/HP Exstream/LiveEditor 4.0.104/Live.exe'
	def LEPath = 'C:/Program Files (x86)/Internet Explorer/iexplore.exe'
	def baseUrl = 'http://localhost:8080/DocServer/'

	// define output folder
	def confOutputFolder = /C\:\\HpExstream\\Sources\\apache-tomcat-7.0.57-windows-x64\\apache-tomcat-7.0.57\\webapps\\DocServer\\¤{0}/	
     //def confOutputFolder = /C:\\HpExstream\\Outputs\\¤{0}/
     
     def cmdLine2 = (cmdLine =~ /${confOutputFolder}/).replaceFirst(baseUrl).replaceAll(/\\¤{0}/,'/') //+"?dummy=.DLF"
		
	def command = "${LEPath} ${cmdLine2}"      
	log.info("***" + command)
	//def proc = command.execute()    
	//proc.waitFor()    
}


</script></con:config></con:testStep><con:properties/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="RunDLFFromIE" searchProperties="true" id="6d1fd511-2a4a-4b8c-9bb0-5ee5efe81d7d"><con:settings/><con:testStep type="groovy" name="RunDLFFromExistingFile"><con:settings/><con:config><script>// run the live editor
def runLiveEditorWithinIE(cmdLine) {
	//def LEPath = 'C:/Program Files (x86)/Hewlett-Packard/HP Exstream/LiveEditor 4.0.104/Live.exe'
	def LEPath = 'C:/Program Files (x86)/Internet Explorer/iexplore.exe'
	def command = "${LEPath} ${cmdLine}"      // Create the String
	def proc = command.execute()    // Call *execute* on the string
	proc.waitFor()                  // Wait for the command to finish
}

String HOMEDIR = "D:/X118372/CCM/poc/CCMHPE"
runLiveEditorWithinIE("${HOMEDIR}/prefilled.dlf")</script></con:config></con:testStep><con:properties/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="SOAPInject" searchProperties="true" disabled="true"><con:settings/><con:testStep type="request" name="Requete_PDF" disabled="true"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>EngineServicePortBinding</con:interface><con:operation>Compose</con:operation><con:request name="Requete_PDF"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://localhost:8080/EngineService/EngineService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:eng="urn:hpexstream-services/Engine">
   <soapenv:Header/>
   <soapenv:Body>
      <eng:Compose>
         <!--Optional:-->
         <EWSComposeRequest>
            <!--Optional:-->
            <driver>
               <!--Optional:-->
               <driver>PEN1c3RvbWVyPg0KPERvYz5IZWxsb1dvcmxkPC9Eb2M+DQo8L0N1c3RvbWVyPg==</driver>
               <!--Optional:-->
               <fileName>INPUT</fileName>
            </driver>
            <!--Zero or more repetitions:-->
            <engineOptions>
               <!--Optional:-->
               <name>TRACKIN</name>
               <!--Optional:-->
               <value>DISABLE</value>
            </engineOptions>
            <!--Optional:-->
            <includeHeader>true</includeHeader>
            <includeMessageFile>true</includeMessageFile>
            <!--Optional:-->
            <pubFile>HelloWorld_PDF.pub</pubFile>
         </EWSComposeRequest>
      </eng:Compose>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response"/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="RunDLF" disabled="true"><con:settings/><con:config><script><![CDATA[// 1st step: Run the SOAP request against the EWS web service and retrieve the base64 encoded response
// Either continue or stop based on error status
def step1ReadDLFAsSOAP() {
	File f = new File("template.dlf")
	String encodedDLF
	int length = -1;
	if (f.exists()) {
		length = f.size()
		def b = new byte[length]
		fis = new	FileInputStream(f).read(b)
		encodedDLF = bytesToBase64(b)
	} else {
		throw new Exception("Cannot read file")
	}
	
"""<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:eng="urn:hpexstream-services/Engine">
   <soapenv:Header/>
   <soapenv:Body>
      <eng:Compose>
         <!--Optional:-->
         <EWSComposeRequest>
            <!--Optional:-->
            <driver>
               <!--Optional:-->
               <driver>${encodedDLF}</driver>
               <!--Optional:-->
               <fileName>INPUT</fileName>
            </driver>
            <!--Zero or more repetitions:-->
            <engineOptions>
               <!--Optional:-->
               <name>TRACKIN</name>
               <!--Optional:-->
               <value>DISABLE</value>
            </engineOptions>
            <!--Optional:-->
            <includeHeader>true</includeHeader>
            <includeMessageFile>true</includeMessageFile>
            <!--Optional:-->
            <pubFile>HelloWorld_Full_Encryption_DLF.pub</pubFile>
         </EWSComposeRequest>
      </eng:Compose>
   </soapenv:Body>
</soapenv:Envelope>"""
}


def step2RunDLF(encodedDLF) {
	// grab the testcase and run it
	def groovyUtils = new com.eviware.soapui.support.GroovyUtils(context);  
	def stepBase = testRunner.testCase.testSteps["Requete_DLF"]; 
	stepBase.setContent(encodedDLF)	
	stepBase.run(testRunner, context)
/*
	// retrieve the returning XML stream
	def xmlResult = stepBase.testRequest.response.getContentAsXml(); 
	log.info(xmlResult)
	
	// get a holder object to deal with XPATH 
	def responseHolder = groovyUtils.getXmlHolder(xmlResult)

	response = responseHolder.getNodeValues("//fileOutput/text()")
	log.info("response size : " + response[0].size())
	def httpResponse = context.expand( '${Test Request: login#Response}' )
	log.info(httpResponse)
	//log.info(">>>" + response[0] +"<<<")
	response[0]

	*/
}

// decode from base64 and store into a template.dlf file
def step2DecodeAndStoreDLF(String text) {
	/*
	String HOMEDIR = "D:/X118372/CCM/poc/CCMHPE"
//	String currDir = new File(".").getAbsolutePath()
//	log.info(currDir)

	File b64 = new  File("${HOMEDIR}/template.base64.txt")
	if (b64.exists()) {
		b64.delete()
	}
	b64.createNewFile()
	b64.setBytes(text.bytes)		 	

	// Write decoded response to DLF file
	byte[] response = base64toBytes(text) //bytes 	
	File f = new File("${HOMEDIR}/template.dlf")
	if (f.exists()) {
		f.delete()
	}
	f.createNewFile()
	f.setBytes(response)		 
	
	"${HOMEDIR}/template.dlf" 
	*/
}

def step3RunLiveEditor(List<String> params) {
	def cmdLineArgs = params.join(" ")
	runLiveEditor(cmdLineArgs)
}

// *************************************************************
// Scenario entry point
// actual program storage folder
def soapRequest = step1ReadDLFAsSOAP()
log.info(soapRequest)
step2RunDLF(soapRequest)
//def dlfPath  = step2DecodeAndStoreDLF(response)
//step3RunLiveEditor([dlfPath])

'COMPLETED OK'



// *************************************************************
// utility functions
//

// decode a base64 string to a stream of bytes
def base64toBytes (String s) {
	if (s.size()==0 || s.trim().size() == 0) { '' } 
	byte[] decBytes = s.decodeBase64()
}

def bytesToBase64(byte[] b) {
	if (b.size()==0) { return "" }
	s = b.encodeBase64()
}

// decode a base64 string to a cleartext string
def base64toString (String s) {
	new String(base64toBytes(s))
}

// split a string and return an array of string
// splitting is done based on the sep character sequence
def getStringAsArray(String fullText,sep="\r\n") {
	def lines = []
	fullText.split(sep).each { String it -> lines.add(it) }  
	lines
}


// run the live editor
def runLiveEditor(cmdLine) {
	//def LEPath = 'C:/Program Files (x86)/Hewlett-Packard/HP Exstream/LiveEditor 4.0.104/Live.exe'
	def LEPath = 'C:/Program Files (x86)/Internet Explorer/iexplore.exe'
	def command = "${LEPath} ${cmdLine}"      // Create the String
	def proc = command.execute()    // Call *execute* on the string
	proc.waitFor()                  // Wait for the command to finish
}]]></script></con:config></con:testStep><con:testStep type="request" name="Requete_DLF" disabled="true"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>EngineServicePortBinding</con:interface><con:operation>Compose</con:operation><con:request name="Requete_DLF"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://FR05168618D:8088/mockEngineServicePortBinding</con:endpoint><con:request/><con:assertion type="SOAP Response"/><con:credentials><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:properties/></con:testCase><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="SecureProxy" searchProperties="true"><con:settings/><con:testStep type="groovy" name="ProxyService"><con:settings/><con:config><script>import groovy.net.soap.SoapServer
import groovy.net.soap.SoapClient
import java.security.SecureRandom
 
class EWSProxyService {

	final PROXY_URL = 'http://localhost:8080/EngineService/EngineService?wsdl'
	final SecureRandom secRand = new SecureRandom()
	
	def EWSProxyService() {
		proxy.initSecret()	
	}
	
	// initialize a secret key between the application and the proxy - this must be a true random sequence hence the use
	// of SecureRandom
	def initSecret() {
		secRand.nextLong()	
	}
	
	def compose() {
		def proxy = new SoapClient(PROXY_URL)		
	
	}

}


def server = new SoapServer("localhost", 6980)
server.setNode("EWSProxyService")
server.start()


</script></con:config></con:testStep><con:testStep type="groovy" name="ClientApplication"><con:settings/><con:config><script>import groovy.net.soap.SoapClient

def proxy = new SoapClient("http://localhost:6980/EWSProxyService?wsdl")

def secretkey = proxy.initSecret()
println("secret key:" + secretkey)
def result = proxy.compose()
 </script></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:testSuite name="Library" disabled="true"><con:settings/><con:runType>SEQUENTIAL</con:runType><con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Utils" searchProperties="true"><con:settings/><con:testStep type="groovy" name="Utils"><con:settings/><con:config><script>// shared class mechanism => http://forum.soapui.org/viewtopic.php?t=15744 thread

class Utils {
	def log
	def context
	def testRunner

	def Utils(logIn, contextIn, testRunnerIn) {
		this.log = logIn
		this.context = contextIn
		this.testRunner = testRunnerIn
	}

	def base64toString (String s) {
		if (s.size()==0 || s.trim().size() == 0) { '' } 
		byte[] decBytes = s.decodeBase64()
		new String(decBytes)
	}
	
	def getStringAsArray(String fullText) {
		def lines = []
		fullText.split("\r\n").each { String it -> lines.add(it) } //collect() //each ( it -> 
		lines
	}
	
	def display (lines) {
		log.info('\r\n\r\n')
		lines.each { it -> log.info(it) }
	}
	

	def execute(message) {
		log.info testRunner
		log.info context
		log.info 	message
		message
	}	
}

</script></con:config></con:testStep><con:testStep type="groovy" name="Code fragments"><con:settings/><con:config><script>def base64toString (String s) {
	if (s.size()==0 || s.trim().size() == 0) { '' } 
	byte[] decBytes = s.decodeBase64()
	new String(decBytes)
}

def getStringAsArray(String fullText,sep="\r\n") {
	def lines = []
	fullText.split(sep).each { String it -> lines.add(it) }  
	lines
}

def decodeMessage(String text) {
	text = base64toString(text)
	
}

// extract the engine message
//log.info commandLines.getClass().getName() + " " + commandLines.size() + " lines found";  // ----------------------  // retrieve the properties step object def configPropsStep = testRunner.testCase.testSteps["configTest"];  // read the 2 properties within it def nbOrdersToCreate = Integer.valueOf(configPropsStep.getPropertyValue("nbOrdersToCreate")); def nbLinesPerOrder = Integer.valueOf(configPropsStep.getPropertyValue("nbLinesPerOrder"));  // compute the amount of line to build def numRows = nbOrdersToCreate * nbLinesPerOrder;  // retrieve the SOAP step : createOrder def createOrderStep = testRunner.testCase.testSteps["createOrder"];  def count = 0; StringBuilder ordersToDelete = new StringBuilder(); for(def i=1; i&lt;=nbOrdersToCreate; i++) {     StringBuilder lines = new StringBuilder();     for(def j=1; j&lt;=nbLinesPerOrder; j++) {         int index = i>1 ? (i-1) * nbLinesPerOrder + j-1 : i*j-1;         lines.append(OrderLines.getAt(index));     }       // transfer the Orderlines as String into the temp properties step     tempProps.setPropertyValue("orderlines", lines.toString());     tempProps.setPropertyValue("numOrder", String.valueOf(count++));       // run the SOAP step Create     testRunner.runTestStep(createOrderStep);       // retrieve the SOAP response as XML     def xmlRespCreate = createOrderStep.testRequest.response.getContentAsXml();     def createHolder = groovyUtils.getXmlHolder(xmlRespCreate);        // assume that the createOrder operation returns an order code in the right tag     def OrderCode = createHolder.getNodeValue("//OrderCode");        // build the string to put in the deleteOrder SOAP step     ordersToDelete.append("&lt;OrderCode>" + OrderCode + "&lt;/OrderCode>"); }  // finally, transfert this String into the temp properties step. tempProps.setPropertyValue("ordersToDelete

//def commandLines = responseHolder.getNodeValues("//fileOutput/text()")
//commandLines.each { commandLine ->
//	log.info(getStringAsArray(base64toString(commandLine),"\n"))
//}

'COMPLETED OK'</script></con:config></con:testStep><con:properties/></con:testCase><con:properties/></con:testSuite><con:properties/><con:beforeSaveScript>println("jey")</con:beforeSaveScript><con:wssContainer/><con:oAuth2ProfileContainer/><con:sensitiveInformation/></con:soapui-project>